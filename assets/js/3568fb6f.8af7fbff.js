"use strict";(self.webpackChunkeverscale_docs_website=self.webpackChunkeverscale_docs_website||[]).push([[7547],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=c(n),h=r,m=u["".concat(l,".").concat(h)]||u[h]||p[h]||o;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2959:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return p}});var a=n(3117),r=n(102),o=(n(7294),n(3905)),s=["components"],i={sidebar_position:3,"//":null},l="TON Wallet API",c={unversionedId:"develop/nodes-clients/ton-wallet-api",id:"develop/nodes-clients/ton-wallet-api",title:"TON Wallet API",description:"Via following this link you can find all necessary information concerning the interaction with and configuration of Ton wallet API.",source:"@site/../../src/develop/nodes-clients/ton-wallet-api.md",sourceDirName:"develop/nodes-clients",slug:"/develop/nodes-clients/ton-wallet-api",permalink:"/develop/nodes-clients/ton-wallet-api",draft:!1,editUrl:"https://github.com/everscale-org/docs/edit/main/.build/website/../../src/develop/nodes-clients/ton-wallet-api.md",tags:[],version:"current",lastUpdatedAt:1661950347,formattedLastUpdatedAt:"Aug 31, 2022",sidebarPosition:3,frontMatter:{sidebar_position:3,"//":null},sidebar:"tutorialSidebar",previous:{title:"Evernode Dapp Server",permalink:"/develop/nodes-clients/evernode-ds"},next:{title:"TON Kafka Producer",permalink:"/develop/nodes-clients/ton-kafka"}},d={},p=[{value:"Using the TON Wallet API",id:"using-the-ton-wallet-api",level:2},{value:"1. Brief description of Ton-Wallet-API.",id:"1-brief-description-of-ton-wallet-api",level:3},{value:"2. Setup",id:"2-setup",level:3},{value:"Add root token to whitelist",id:"add-root-token-to-whitelist",level:4},{value:"3. Transfer EVER",id:"3-transfer-ever",level:3},{value:"4. How to process a transaction from a user on the backend",id:"4-how-to-process-a-transaction-from-a-user-on-the-backend",level:3},{value:"5. Token transfer",id:"5-token-transfer",level:3}],u={toc:p};function h(e){var t=e.components,n=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"ton-wallet-api"},"TON Wallet API"),(0,o.kt)("p",null,"Via following ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/broxus/ton-wallet-api"},"this link")," you can find all necessary information concerning the interaction with and configuration of Ton wallet API. "),(0,o.kt)("p",null,"In order to understand how to send transactions and track their statuses please see the guide below."),(0,o.kt)("h2",{id:"using-the-ton-wallet-api"},"Using the TON Wallet API"),(0,o.kt)("h3",{id:"1-brief-description-of-ton-wallet-api"},"1. Brief description of Ton-Wallet-API."),(0,o.kt)("p",null,"This API guide is intended to explain how to send and track transactions with the help of Ever Wallet.",(0,o.kt)("br",{parentName:"p"}),"\n","The wallet tracks addresses from the database and indexes all transactions, storing the information about them in the postgres DB.",(0,o.kt)("br",{parentName:"p"}),"\n","All transactions with native EVERs are tracked, and there is a whitelist of Root Token addresses to be tracked in the settings.",(0,o.kt)("br",{parentName:"p"}),"\n","There is a Callbacks Table in the database, where you can specify the URL of your backend to which callbacks will come for all transactions."),(0,o.kt)("p",null,"It takes about 40 minutes to synchronize the node.",(0,o.kt)("br",{parentName:"p"}),"\n","Both the Ton-Wallet-API and callback requests use HMAC signatures in the headers."),(0,o.kt)("h3",{id:"2-setup"},"2. Setup"),(0,o.kt)("p",null,"You need postgres11 + a dedicated server to work",(0,o.kt)("br",{parentName:"p"}),"\n","CPU: 4 cores, 2 GHz",(0,o.kt)("br",{parentName:"p"}),"\n","RAM: 8 GB",(0,o.kt)("br",{parentName:"p"}),"\n","Storage: 200 GB fast SSD",(0,o.kt)("br",{parentName:"p"}),"\n","Network: 100 MBit/s   "),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Follow the instructions from the Readme ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/broxus/ton-wallet-api"},"https://github.com/broxus/ton-wallet-api")),(0,o.kt)("li",{parentName:"ol"},'Create yourself a "system address" by calling ',(0,o.kt)("inlineCode",{parentName:"li"},"/address/create")," with empty parameters. The response will return an EVER address. It is necessary to send EVERs to it, which will be consumed as gas for further work."),(0,o.kt)("li",{parentName:"ol"},"In the table ",(0,o.kt)("inlineCode",{parentName:"li"},"api_service_callback")," we enter the address of our backend, which will deal with transaction processing."),(0,o.kt)("li",{parentName:"ol"},"Configure token whitelist:",(0,o.kt)("br",{parentName:"li"}),"You can see the Root-Contract addresses at ",(0,o.kt)("a",{parentName:"li",href:"https://raw.githubusercontent.com/broxus/ton-assets/master/manifest.json"},"https://raw.githubusercontent.com/broxus/ton-assets/master/manifest.json"),".",(0,o.kt)("br",{parentName:"li"}),"By default, the whitelist already includes all the tokens in this list.\nTo add more tokens to the whitelist use the script below:")),(0,o.kt)("h4",{id:"add-root-token-to-whitelist"},"Add root token to whitelist"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"DATABASE_URL=${DATABASE_URL} RUSTFLAGS='-C target-cpu=native' cargo run \\\n  --release -- root_token \\\n  --name USDT --address 0:751b6e22687891bdc1706c8d91bf77281237f7453d27dc3106c640ec165a2abf\n")),(0,o.kt)("h3",{id:"3-transfer-ever"},"3. Transfer EVER"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n // To create a transaction you will need a sender\'s address. For example, your system address.   \n\n "fromAddress": "0:0000000000000000000000000000000000000000000000000000000000000000",  \n  "bounce": false,    \n\n  // a random uuid that you generate for yourself and store it on your backend to further track the status of the transaction\n\n "ID": "00000000-0000-0000-0000-000000000000",      \n \n "outputs": [\n   {\n     // How many EVERs to send. To send 1 EVER this value = 1000000000\n     "value": "1000000000"\n     // Set Normal to deduct the number of sent EVERs from the value    \n     "outputType": "Normal",    \n     // Recipient address of EVERs    \n     "recipientAddress": "0:0000000000000000000000000000000000000000000000000000000000000000",    \n   }\n ]\n}\n')),(0,o.kt)("p",null,"You can track the status of a transaction via the following two ways:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The recommended way is via callback ",(0,o.kt)("inlineCode",{parentName:"li"},"AccountTransactionEvent"),", which has ",(0,o.kt)("inlineCode",{parentName:"li"},"transactionStatus")," field:",(0,o.kt)("br",{parentName:"li"}),(0,o.kt)("inlineCode",{parentName:"li"},"Expired")," - end state for failed transactions,",(0,o.kt)("br",{parentName:"li"}),(0,o.kt)("inlineCode",{parentName:"li"},"Done")," - final state for successful transactions. "),(0,o.kt)("li",{parentName:"ol"},"The second way is by polling the GET method ",(0,o.kt)("inlineCode",{parentName:"li"},"/transactions/id/<uuid>"))),(0,o.kt)("h3",{id:"4-how-to-process-a-transaction-from-a-user-on-the-backend"},"4. How to process a transaction from a user on the backend"),(0,o.kt)("p",null,"We generate a deposit address for the user by calling  ",(0,o.kt)("inlineCode",{parentName:"p"},"/address/create")," with empty parameters."),(0,o.kt)("p",null,"After receiving the transaction, the backend receives a callback of the form ",(0,o.kt)("inlineCode",{parentName:"p"},"AccountTransactionEvent")," (see swagger).",(0,o.kt)("br",{parentName:"p"}),"\n","You can also get such events in a list, using the ",(0,o.kt)("inlineCode",{parentName:"p"},"/events")," method."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"To merge tokens to the system address, you can use the ",(0,o.kt)("inlineCode",{parentName:"li"},"/tokens/transactions/create")," method in such a callback (see ",(0,o.kt)("a",{parentName:"li",href:"#5-token-transfer"},'"5. Token Transfer."'),")"),(0,o.kt)("li",{parentName:"ol"},"If your backend was not working at the time of the callback or responded with an error, the event will have an Error status.")),(0,o.kt)("h3",{id:"5-token-transfer"},"5. Token transfer"),(0,o.kt)("p",null,"First, check the status and balance of the address you want to send tokens from by making a GET request to ",(0,o.kt)("inlineCode",{parentName:"p"},"/address/{string}"),"\nThe address you are sending tokens from must have at least 0.6 EVER (balance >= 600000000), if the balance is not enough, top it up (see ",(0,o.kt)("a",{parentName:"p",href:"#3-transfer-ever"},'"3. Transfer EVER"')," )"),(0,o.kt)("p",null,"To transfer tokens, use the method ",(0,o.kt)("inlineCode",{parentName:"p"},"/tokens/transactions/create")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n\n // Sender  \n "fromAddress": "string",  \n // Receiver            \n "recipientAddress": "string",              \n\n //  The number of tokens with decimals. For example, for transferring 1 USDT this value = "1000000"\n "value": "1000000"\n\n // How many EVERs to apply. The default recommended value is 0.5 EVER. The funds will be debited fromAddress.\n "fee": "5000000000",  \n\n // The address to which to return the remaining EVERs. For example, your system address.\n "sendGasTo": "string",                                \n\n // A random uuid that you generate yourself and store on your backend to further track the status of the transaction\n "id": "00000000-0000-0000-0000-000000000000",      \n\n // Token Address. (see https://raw.githubusercontent.com/broxus/ton-assets/master/manifest.json)\n \n\n "rootAddress": "string",                    \n}\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"}," The documentation in Everscale repository is a community effort. Therefore, everyone can contribute with proposals for new topics, suggest new content elements, participate in editing, and provide ideas that will be of great help for network development.\nPlease be informed that our documentation can be ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/everscale-org/docs/issues"},"edited via GitHub"),".",(0,o.kt)("br",{parentName:"p"}),"\n","Also please make sure to consult our rules and rewards policy via ",(0,o.kt)("a",{parentName:"p",href:"https://docs.everscale.network/contribute/hot-streams/documentations"},"this link"),".",(0,o.kt)("br",{parentName:"p"}),"\n","Feel free to join ",(0,o.kt)("a",{parentName:"p",href:"https://t.me/+C2IpQXWZtCwxYzEy"},"Everscale Documentation Development Telegram chat")," and ",(0,o.kt)("a",{parentName:"p",href:"https://t.me/+Vca1Gs6uPzIyNWVi"},"Everscale Developers Onboarding Telegram chat"),"!")))}h.isMDXComponent=!0}}]);